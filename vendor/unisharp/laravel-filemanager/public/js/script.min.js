var show_list;var sort_type="alphabetic";$(document).ready(function(){bootbox.setDefaults({locale:lang["locale-bootbox"]});loadFolders();performLfmRequest("errors").done(function(c){var a=JSON.parse(c);for(var b=0;b<a.length;b++){$("#alerts").append($("<div>").addClass("alert alert-warning").append($("<i>").addClass("fa fa-exclamation-circle")).append(" "+a[b]))}})});$("#nav-buttons a").click(function(a){a.preventDefault()});$("#to-previous").click(function(){var a=getPreviousDir();if(a==""){return}goTo(a)});$("#add-folder").click(function(){bootbox.prompt(lang["message-name"],function(a){if(a==null){return}createFolder(a)})});$("#upload").click(function(){$("#uploadModal").modal("show")});$("#upload-btn").click(function(){$(this).html("").append($("<i>").addClass("fa fa-refresh fa-spin")).append(" "+lang["btn-uploading"]).addClass("disabled");function a(){$("#uploadModal").modal("hide");$("#upload-btn").html(lang["btn-upload"]).removeClass("disabled");$("input#upload").val("")}$("#uploadForm").ajaxSubmit({success:function(c,d,e,b){a();refreshFoldersAndItems(c);displaySuccessMessage(c)},error:function(b,d,c){displayErrorResponse(b);a()}})});$("#thumbnail-display").click(function(){show_list=0;loadItems()});$("#list-display").click(function(){show_list=1;loadItems()});$("#list-sort-alphabetic").click(function(){sort_type="alphabetic";loadItems()});$("#list-sort-time").click(function(){sort_type="time";loadItems()});$(document).on("click",".file-item",function(a){useFile($(this).data("id"))});$(document).on("click",".folder-item",function(a){goTo($(this).data("id"))});function goTo(a){$("#working_dir").val(a);loadItems()}function getPreviousDir(){var d="/";var c=$("#working_dir").val();var b=c.lastIndexOf(d);var a=c.substring(0,b);return a}function dir_starts_with(a){return $("#working_dir").val().indexOf(a)===0}function setOpenFolders(){var b=$(".folder-item");for(var a=b.length-1;a>=0;a--){if(!dir_starts_with($(b[a]).data("id"))){$(b[a]).children("i").removeClass("fa-folder-open").addClass("fa-folder")}else{$(b[a]).children("i").removeClass("fa-folder").addClass("fa-folder-open")}}}function performLfmRequest(a,d,b){var c=defaultParameters();if(d!=null){$.each(d,function(e,f){c[e]=f})}return $.ajax({type:"GET",dataType:b||"text",url:lfm_route+"/"+a,data:c,cache:false}).fail(function(e,g,f){displayErrorResponse(e)})}function displayErrorResponse(a){notify('<div style="max-height:50vh;overflow: scroll;">'+a.responseText+"</div>")}function displaySuccessMessage(a){if(a=="OK"){var b=$("<div>").addClass("alert alert-success").append($("<i>").addClass("fa fa-check")).append(" File Uploaded Successfully.");$("#alerts").append(b);setTimeout(function(){b.remove()},2000)}}var refreshFoldersAndItems=function(a){loadFolders();if(a!="OK"){a=Array.isArray(a)?a.join("<br/>"):a;notify(a)}};var hideNavAndShowEditor=function(a){$("#nav-buttons > ul").addClass("hidden");$("#content").html(a)};function loadFolders(){performLfmRequest("folders",{},"html").done(function(a){$("#tree").html(a);loadItems()})}function loadItems(){performLfmRequest("jsonitems",{show_list:show_list,sort_type:sort_type},"html").done(function(b){var a=JSON.parse(b);$("#content").html(a.html);$("#nav-buttons > ul").removeClass("hidden");$("#working_dir").val(a.working_dir);$("#current_dir").text(a.working_dir);console.log("Current working_dir : "+$("#working_dir").val());if(getPreviousDir()==""){$("#to-previous").addClass("hide")}else{$("#to-previous").removeClass("hide")}setOpenFolders()})}function createFolder(a){performLfmRequest("newfolder",{name:a}).done(refreshFoldersAndItems)}function rename(a){bootbox.prompt({title:lang["message-rename"],value:a,callback:function(b){if(b==null){return}performLfmRequest("rename",{file:a,new_name:b}).done(refreshFoldersAndItems)}})}function trash(a){bootbox.confirm(lang["message-delete"],function(b){if(b==true){performLfmRequest("delete",{items:a}).done(refreshFoldersAndItems)}})}function cropImage(a){performLfmRequest("crop",{img:a}).done(hideNavAndShowEditor)}function resizeImage(a){performLfmRequest("resize",{img:a}).done(hideNavAndShowEditor)}function download(b){var a=defaultParameters();a.file=b;location.href=lfm_route+"/download?"+$.param(a)}function useFile(e){function g(n){var m=new RegExp("(?:[?&]|&)"+n+"=([^&]+)","i");var l=window.location.search.match(m);return(l&&l.length>1)?l[1]:null}function b(l){var m=tinyMCEPopup.getWindowArg("window");m.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=l;if(typeof(m.ImageDialog)!="undefined"){if(m.ImageDialog.getImageData){m.ImageDialog.getImageData()}if(m.ImageDialog.showPreviewImage){m.ImageDialog.showPreviewImage(l)}}tinyMCEPopup.close()}function j(l,m){parent.document.getElementById(m).value=l;if(typeof parent.tinyMCE!=="undefined"){parent.tinyMCE.activeEditor.windowManager.close()}if(typeof parent.$.fn.colorbox!=="undefined"){parent.$.fn.colorbox.close()}}function d(l){if(window.opener){window.opener.CKEDITOR.tools.callFunction(g("CKEditorFuncNum"),l)}else{parent.CKEDITOR.tools.callFunction(g("CKEditorFuncNum"),l);parent.CKEDITOR.tools.callFunction(g("CKEditorCleanUpFuncNum"))}}function k(m){var o=m;var l=data.Properties["Width"];var n=data.Properties["Height"];window.opener.SetUrl(o,l,n)}var a=e;var f=g("field_name");var i=g("CKEditor");var c=typeof data!="undefined"&&data.Properties["Width"]!="";var h=a.replace(route_prefix,"");if(window.opener||window.tinyMCEPopup||f||g("CKEditorCleanUpFuncNum")||i){if(window.tinyMCEPopup){b(a)}else{if(f){j(a,f)}else{if(i){d(a)}else{if(c){k(a)}else{window.opener.SetUrl(a,h)}}}}if(window.opener){window.close()}}else{window.open(a)}}function defaultParameters(){return{working_dir:$("#working_dir").val(),type:$("#type").val()}}function notImp(){notify("Not yet implemented!")}function notify(a){bootbox.alert(a)}function fileView(a,b){bootbox.dialog({title:lang["title-view"],message:$("<img>").addClass("img img-responsive center-block").attr("src",a+"?timestamp="+b),size:"large",onEscape:true,backdrop:true})};