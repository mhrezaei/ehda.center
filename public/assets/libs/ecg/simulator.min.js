window.caseId=1;window.reactions=[];window.timers={};$(document).ready(function(){fixBodyHeight();loadData();$(window).resize(function(){fixBodyHeight()});$(".pass-step").click(function(){var page=$(this).closest(".page");passStep(page)});$(".back-step").click(function(){var page=$(this).closest(".page");backStep(page)});$("form.treatment-form").find(":input").change(function(){var that=$(this);var related=that.attr("data-relted");if(related){if(that.val()){$(related).closest(".form-group").show()}else{$(related).closest(".form-group").hide()}}});$("form.treatment-form").submit(function(event){event.preventDefault();var form=$(this);var equations=window.caseData.calculations;var treatment=form.attr("data-treatment");var data=form.serializeObject();var toDo=eval("equations"+dash2brace(treatment));var doneActions=[];$.each(toDo,function(num,tasks){$.each(tasks,function(val,targets){$.each(targets,function(targetName,equation){$.each(data,function(fieldName,fieldValue){equation=equation.replace("{{"+fieldName+"}}",fieldValue)});doneActions.push({target:targetName,equation:equation});equation=equation.replace("{{orig}}",window.currentData[targetName]);window.currentData[targetName]=eval(equation)})})});console.log(doneActions);window.reactions.push(doneActions)})});function fixBodyHeight(){var b=$("body").height();var a=$(".container-main").height();if(a>b){$("body").height(a)}else{$("body").height("")}}function dash2brace(b){var c=b.split("-");var a="";$.each(c,function(d,e){a+="["+e+"]"});return a}function loadData(){loading();$.getJSON(siteUrl+"/files/ecg/json/cases.json",function(a){var b=a[window.caseId];window.caseData=b;window.currentData=b.defaultData;$(".case-biography").html(b.caseInfo.information);$(".case-height").html(b.caseInfo.height);$(".case-weight").html(b.caseInfo.weight);$(".case-urine-output").html(b.caseInfo.urineOutput);$(".case-more-information").html(b.caseInfo.moreInformation);$.each(b.defaultData.exams,function(c,d){$.each(d,function(e,g){var f=["case",c,e].join(" ").title2kebab();$("."+f).html(g)})});loading("hide")})}function loading(a){var b=$(".cover-page");if(typeof a!="undefined"||a=="hide"){b.fadeOut("slow")}else{b.fadeIn("slow")}}function passStep(b){var c=b.attr("data-step");window.tmpReaction={fromStep:c,fromPage:b,forward:true,done:false};var a="pass"+c+"Step";window[a](b);if(window.tmpReaction.done){delete window.tmpReaction.done;window.reactions.push(window.tmpReaction);console.log(window.reactions)}}function passStartStep(){$("#start").removeClass("current");$("#start-question").addClass("current");window.tmpReaction.toStep=$("#start-question").attr("data-step");window.tmpReaction.toPage=$("#start-question");window.tmpReaction.done=true}function passStartQuestionStep(a){var b=$("input[type=radio][name=start-question]:checked").val();if(b){$("#start-question").removeClass("current");switch(b){case"1":$("#more-info").addClass("current");window.tmpReaction.toStep=$("#more-info").attr("data-step");window.tmpReaction.toPage=$("#more-info");pageTimeout($("#more-info"),2*60*1000,ventricularTachycardia);break;case"2":$("#laboratory-exams").addClass("current");window.tmpReaction.toStep=$("#laboratory-exams").attr("data-step");window.tmpReaction.toPage=$("#laboratory-exams");pageTimeout($("#laboratory-exams"),2*60*1000,ventricularTachycardia);break;case"3":$("#treatment-modalities").addClass("current");window.tmpReaction.toStep=$("#treatment-modalities").attr("data-step");window.tmpReaction.toPage=$("#treatment-modalities");break}window.tmpReaction.done=true}}function backStep(d){var c=window.reactions.last();var a=d.attr("timeout");if(a){clearTimeout(window.timers[a])}var b={fromStep:c.toStep,fromPage:c.toPage,toStep:c.fromStep,toPage:c.fromPage,forward:false};b.fromPage.removeClass("current");b.toPage.addClass("current");window.reactions.push(b)}function pageTimeout(c,d,b){var a="timeout"+$.now();console.log(c);console.log(d/1000);window.timers[a]=setTimeout(function(){if(c.hasClass("current")){b()}},d);c.attr("timeout",a)}function ventricularTachycardia(){alert("VTACH!!!!!!!!!!!!!!!!!!!!!!!!!!!!")}function refreshScreen(){};