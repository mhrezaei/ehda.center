window.caseId=1;window.reactions=[];window.timers={};window.shockerCharge=0;$(document).ready(function(){fixBodyHeight();loadData();$(window).resize(function(){fixBodyHeight()});$(".pass-step").click(function(){var page=$(this).closest(".page");passStep(page)});$(".back-step").click(function(){var page=$(this).closest(".page");backStep(page)});$(".treatment-form").find(":input").change(function(){var that=$(this);var related=that.attr("data-relted");if(related){if(that.val()){$(related).closest(".form-group").show()}else{$(related).closest(".form-group").hide()}}});$(".treatment-form").find(".btn-inject").click(function(event){event.preventDefault();var btn=$(this);var box=btn.closest(".treatment-form");var treatment=box.attr("data-treatment");var data=box.find(":input").serializeObject();if(!Object.values(data).includes("")){var equations=window.caseData.calculations;var toDo=eval("equations"+dash2brace(treatment));var doneActions=[];$.each(toDo,function(num,tasks){if(num){var checkingField=[treatment,num].join("-")}else{var checkingField=treatment}if(!$.isArray(data[checkingField])){data[checkingField]=[data[checkingField]]}$.each(tasks,function(val,targets){if($.inArray(val,data[checkingField])>-1){$.each(targets,function(targetName,equation){$.each(data,function(fieldName,fieldValue){equation=equation.replace(new RegExp("{{"+fieldName+"}}","g"),fieldValue)});var tmpAction={target:targetName,equation:equation,before:window.currentData[targetName]};equation=equation.replace(new RegExp("{{orig}}","g"),window.currentData[targetName]);var result=eval(equation);window.currentData[targetName]=Number(result.toFixed(2));tmpAction.after=window.currentData[targetName];doneActions.push(tmpAction)})}})});var lastReaction=window.reactions.last();window.reactions.push({fromStep:lastReaction.toStep,toStep:lastReaction.toStep,fromPage:lastReaction.toPage,toPage:lastReaction.toPage,forward:true,calculations:doneActions});refreshScreen();if(!$(".second-preview").is(":visible")){$(".second-preview").slideDown()}btn.hide()}});$(".monitor-ecg-shock-box").find(".btn-charge-shocker").click(function(){var energy=$(".shocker-energy").val();console.log(energy);chargeShocker(energy)});$(".monitor-ecg-shock-box").find(".btn-shock").click(function(){$(".shocker-charger-box").css("opacity",0);doShock()})});function fixBodyHeight(){var b=$("body").height();var a=$(".container-main").height();if(a>b){$("body").height(a)}else{$("body").height("")}}function dash2brace(b){var c=b.split("-");var a="";$.each(c,function(d,e){a+="["+e+"]"});return a}function loadData(){loading();$.getJSON(siteUrl+"/files/ecg/json/cases.json",function(a){var b=a[window.caseId];window.caseData=b;window.currentData=b.defaultData;$(".case-biography").html(b.caseInfo.information);$(".case-height").html(b.caseInfo.height);$(".case-weight").html(b.caseInfo.weight);$(".case-urine-output").html(b.caseInfo.urineOutput);$(".case-more-information").html(b.caseInfo.moreInformation);$.each(b.defaultData.exams,function(c,d){$.each(d,function(e,g){var f=["case",c,e].join(" ").title2kebab();$("."+f).html(g)})});refreshScreen();loading("hide")})}function loading(a){var b=$(".cover-page");if(typeof a!="undefined"||a=="hide"){b.fadeOut("slow")}else{b.fadeIn("slow")}}function passStep(b){var c=b.attr("data-step");window.tmpReaction={fromStep:c,fromPage:b,forward:true,done:false};var a="pass"+c+"Step";window[a](b);if(window.tmpReaction.done){delete window.tmpReaction.done;window.reactions.push(window.tmpReaction);console.log(window.reactions)}}function passStartStep(){$("#start").removeClass("current");$("#start-question").addClass("current");window.tmpReaction.toStep=$("#start-question").attr("data-step");window.tmpReaction.toPage=$("#start-question");window.tmpReaction.done=true}function passStartQuestionStep(a){var b=$("input[type=radio][name=start-question]:checked").val();if(b){$("#start-question").removeClass("current");switch(b){case"1":$("#more-info").addClass("current");window.tmpReaction.toStep=$("#more-info").attr("data-step");window.tmpReaction.toPage=$("#more-info");pageTimeout($("#more-info"),2*60*1000,ventricularTachycardia);break;case"2":$("#laboratory-exams").addClass("current");window.tmpReaction.toStep=$("#laboratory-exams").attr("data-step");window.tmpReaction.toPage=$("#laboratory-exams");pageTimeout($("#laboratory-exams"),2*60*1000,ventricularTachycardia);break;case"3":$("#treatment-modalities").addClass("current");window.tmpReaction.toStep=$("#treatment-modalities").attr("data-step");window.tmpReaction.toPage=$("#treatment-modalities");$("#treatment-modalities").find("select").each(function(){$(this).val($(this).children("option").first().val())});break}window.tmpReaction.done=true}}function backStep(d){var c=window.reactions.last();console.log(c);if(typeof d!="undefined"){var a=d.attr("timeout");if(a){clearTimeout(window.timers[a])}}var b={fromStep:c.toStep,fromPage:c.toPage,toStep:c.fromStep,toPage:c.fromPage,forward:false};if(c.calculations){b.calculations=[];$.each(c.calculations,function(e,f){b.calculations.push({after:f.before,before:f.after,target:f.target});console.log(f.target);window.currentData[f.target]=f.before})}refreshScreen();b.fromPage.removeClass("current");b.toPage.addClass("current");window.reactions.push(b)}function pageTimeout(c,d,b){var a="timeout"+$.now();console.log(c);console.log(d/1000);window.timers[a]=setTimeout(function(){if(c.hasClass("current")){b()}},d);c.attr("timeout",a)}function ventricularTachycardia(){var a=210;$(".monitor-ecg-preview-inner").addClass("VTach");var b=window.reactions.last();window.reactions.push({fromStep:b.toStep,toStep:b.toStep,fromPage:b.toPage,toPage:b.toPage,forward:true,calculations:[{before:window.currentData.HR,after:a,target:"HR"}]});window.currentData.HR=a;refreshScreen();$(".monitor-ecg-shock-box").show();$(".monitor-case-management-panel").hide()}function refreshScreen(){$(".preview-bp").html(window.currentData.SBP+"/"+window.currentData.DBP);$(".preview-hr").html(window.currentData.HR);$(".preview-rr").html(window.currentData.RR);$(".preview-spo2").html(window.currentData.SPO2);$(".preview-cvp").html(window.currentData.CVP);$(".preview-temperature").html(window.currentData.T);$(".preview-uop").html(window.currentData.UOP);$(".preview-hgb").html(window.currentData.HgB);$(".preview-inr").html(window.currentData.INR);$(".preview-bs").html(window.currentData.BS);$(".preview-na").html(window.currentData.Na);$(".preview-k").html(window.currentData.K);$(".preview-ca").html(window.currentData.Ca);$(".preview-ph").html(window.currentData.PH);$(".preview-pco2").html(window.currentData.PCO2);$(".preview-hco3").html(window.currentData.HCO3);$(".preview-po2").html(window.currentData.PO2);runECG(window.currentData.HR)}function runECG(a){stopECG();runECGPeriod(a);window.timers.ecgMotion=setInterval(function(){runECGPeriod(a)},60*1000)}function runECGPeriod(a){$(".monitor-ecg-preview-inner").animate({"background-position-x":"+="+a+"%"},60000,"linear")}function stopECG(a){clearInterval(window.timers.ecgMotion);$(".monitor-ecg-preview-inner").stop();delete window.timers.ecgMotion}function chargeShocker(c){var b=100;var a=$(".shocker-charger-box");var d=a.find(".progress-bar");var e=(c/b)*1000;a.css("opacity",1);d.css("width",0);d.animate({width:"100%"},e,function(){$(".monitor-ecg-shock-box").find(".btn-shock").removeAttr("disabled");window.shockerCharge=c})}function doShock(){$(".monitor-ecg-preview-inner").removeClass("VTach");backStep();$(".monitor-case-management-panel").show();$(".monitor-ecg-shock-box").hide()};