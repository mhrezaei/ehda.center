String.prototype.replaceAll=function(e,d){var f=this;return f.replace(new RegExp(e,"g"),d)};$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});jQuery(function(j){console.log(getUrlParam("multi"));window.fileManagerModalOptions=getValueOf(parent.window.fileManagerModalOptions?parent.window.fileManagerModalOptions:{});selectFolder(j(".breadcrumb-folders .folder").first());var i=j(window),f=j(".media-sidebar"),h=j(".media-footer"),g=j(".media-router .media-menu-item");j(".breadcrumb-folders li a").click(function(a){a.preventDefault();var b=j(this).closest(".folder");selectFolder(b)});i.on("resize load",function(){var a=i.width();if(a<=900){j(".media-folder-menu").hide();j(".media-frame-title .menu-icon").on("click",function(){j(".media-folder-menu").show()});j(".media-folder-menu .close-sidebar").on("click",function(){j(".media-folder-menu").hide()})}else{j(".media-folder-menu").show()}if(a<=768){j(".media-sidebar").hide();j(".media-sidebar .close-sidebar").on("click",function(){j(".media-sidebar").hide()})}else{j(".media-sidebar").show()}});j("#thumbnail").selectable({selecting:function(b,a){var e=j(this),c=j(a.selecting),d=c.find("img").attr("src"),l=d.replace("img/","");if(!f.is(":visible")){f.show()}f.find(".file-details").show();f.find(".thumbnail-image img").attr("src",d);f.find(".details .filename").empty().text(l);e.find(".active").removeClass("active");c.addClass("active")},stop:function(b,a){var c=j("li.ui-selected").clone().removeClass("active ui-selected"),e=c.length,d=pd(e);h.find(".attachments-preview").empty().append(c);h.find(".count").empty().text("گزینش شده: "+d);j("#add-btn").val(c)}});j("#clear-list").on("click",function(){j("li.ui-selected").removeClass("active ui-selected");f.find(".file-details").hide();h.find(".attachments-preview").empty("active ui-selected");h.find(".count").empty().text("گزینش شده: "+pd("0"));j("#add-btn").val("")});g.on("click",function(a){a.preventDefault();g.removeClass("active");var b=j(this).addClass("active").data("page");j(".page").hide();j("#"+b).show()});j(document).on({click:function(){useFile(j(this).data("file"))}},".thumbnail")});function forms_pd(b){if(!b){b="0"}b=b.toString();b=b.replaceAll(/1/g,"۱");b=b.replaceAll(/2/g,"۲");b=b.replaceAll(/3/g,"۳");b=b.replaceAll(/4/g,"۴");b=b.replaceAll(/5/g,"۵");b=b.replaceAll(/6/g,"۶");b=b.replaceAll(/7/g,"۷");b=b.replaceAll(/8/g,"۸");b=b.replaceAll(/9/g,"۹");b=b.replaceAll(/0/g,"۰");return b}function forms_digit_fa(i){return forms_pd(i);var h="";for(var f=0;f<i.length;f++){var j=i.charCodeAt(f);if(j>=48&&j<=57){var g=j+1584;h=h+String.fromCharCode(g)}else{h=h+String.fromCharCode(j)}}return h}function pd(b){return forms_digit_fa(b)}function selectFolder(d){var e=getFolderParents(d);$(".breadcrumb-folders .folder").removeClass("active");$(".folder .folder-icon").removeClass("fa-folder-open").addClass("fa-folder");$(".breadcrumb-folders li").removeClass("current");d.addClass("current");e.addClass("active");$(".breadcrumb-folders .active").each(function(a){$(this).find("span.folder-icon").first().removeClass("fa-folder").addClass("fa-folder-open")});var f=new FormData();f.append("key",d.attr("data-key"));f.append("instance",d.attr("data-instance"));f.append("_token",csrfToken);$.ajax({url:urls.getList,type:"POST",data:{key:d.attr("data-key"),instance:d.attr("data-instance")},success:function(a){$("#thumbnail").replaceWith($(a))}})}function refreshGallery(){selectFolder($(".breadcrumb-folders .folder.current"))}function getFolderParents(c){var d=c.children("a");return d.parents(".folder")}function eachUploadCompleter(){refreshGallery()}function getFileUrl(b){return $('[data-file="'+b+'"]').data("url")}function getFilePathname(b){return $('[data-file="'+b+'"]').data("pathname")}function showFile(d){var c=window.fileManagerModalOptions.preview;if(c){$.ajax({url:route_preview,type:"post",data:{file:d},success:function(a){parent.document.getElementById(c).innerHTML=a}})}}function getUrlParam(f){var d=new RegExp("(?:[?&]|&)"+f+"=([^&]+)","i");var e=window.location.search.match(d);return(e&&e.length>1)?e[1]:null}function useFile(file){function useTinymce3(url){var win=tinyMCEPopup.getWindowArg("window");win.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=url;if(typeof(win.ImageDialog)!="undefined"){if(win.ImageDialog.getImageData){win.ImageDialog.getImageData()}if(win.ImageDialog.showPreviewImage){win.ImageDialog.showPreviewImage(url)}}tinyMCEPopup.close()}function useTinymce4AndColorbox(url,field_name){parent.document.getElementById(field_name).value=url;if(typeof parent.tinyMCE!=="undefined"){parent.tinyMCE.activeEditor.windowManager.close()}if(typeof parent.$.fn.colorbox!=="undefined"){parent.$.fn.colorbox.close()}}function useCkeditor3(url){if(window.opener){window.opener.CKEDITOR.tools.callFunction(getUrlParam("CKEditorFuncNum"),url)}else{parent.CKEDITOR.tools.callFunction(getUrlParam("CKEditorFuncNum"),url);parent.CKEDITOR.tools.callFunction(getUrlParam("CKEditorCleanUpFuncNum"))}}function useFckeditor2(url){var p=url;var w=data.Properties.Width;var h=data.Properties.Height;window.opener.SetUrl(p,w,h)}function useModal(result){let parentWindow=$(parent.document);let targetInput=parentWindow.find("#"+window.fileManagerModalOptions.input);if(targetInput.length){targetInput.val(result)}showFile(file);let callBackValue=window.fileManagerModalOptions.callback;if(callBackValue){parent.window.eval(callBackValue)}parent.window.closeFileManagerModal()}var url=getFileUrl(file);var pathname=getFilePathname(file);var field_name=getUrlParam("field_name");var is_ckeditor=getUrlParam("CKEditor");var is_modal=window.fileManagerModalOptions.modal;var is_fcke=typeof data!="undefined"&&data.Properties.Width!="";var file_path=url.replace(route_prefix,"");var modal=url.replace(route_prefix,"");if(window.opener||window.tinyMCEPopup||field_name||getUrlParam("CKEditorCleanUpFuncNum")||is_ckeditor||is_modal){if(is_modal){switch(window.fileManagerModalOptions.outputType){case"url":useModal(url,field_name);break;default:useModal(pathname,field_name);break}}else{if(window.tinyMCEPopup){useTinymce3(url)}else{if(field_name){useTinymce4AndColorbox(url,field_name)}else{if(is_ckeditor){useCkeditor3(url)}else{if(is_fcke){useFckeditor2(url)}else{window.opener.SetUrl(url,file_path)}}}}}if(window.opener){window.close()}}else{window.opener.SetUrl(url,file_path)}};