Dropzone.autoDiscover=false;Dropzone.prototype.defaultOptions.url=dropzoneRoutes.upload;Dropzone.prototype.defaultOptions.addRemoveLinks=true;Dropzone.prototype.defaultOptions.dictRemoveFile="";Dropzone.prototype.defaultOptions.dictCancelUpload="";Dropzone.prototype.defaultOptions.dictFileTooBig=messages.errors.size;Dropzone.prototype.defaultOptions.dictInvalidFileType=messages.errors.type;Dropzone.prototype.defaultOptions.dictResponseError=messages.errors.server;Dropzone.prototype.defaultOptions.dictMaxFilesExceeded=messages.errors.size;let fileInfoElTmp=$('<div class="media-uploader-status"> <div class="col-xs-9"> <div class="media-uploader-status-info"> <h2 class="media-uploader-status-text"> </h2> <button type="button" class="fa fa-times-circle delete-upload-info"></button> <div class="media-progress"> <div class="media-progress-value"></div> </div> <div class="upload-detail"> <span class="upload-detail-separator"></span> <span class="upload-filename"></span> </div> </div> </div> <div class="col-xs-3"> <div class="attachment media-uploader-status-image"> <img> </div> </div></div>');var dropzoneOptions={init:{sending:function(b,j,a){a.append("_token",csrfToken);$(b.previewElement).hide();$(b.previewElement).closest(".uploader-container").find(".dz-message").show();var e={};var f=$(".breadcrumb-folders li.current");if(f.length&&(typeof getFolderParents!=undefined)&&$.isFunction(getFolderParents)){var h=getFolderParents(f);h.each(function(){e[$(this).attr("data-instance")]=$(this).attr("data-key")})}a.append("externalFields",JSON.stringify(e));var g=$(this.element).find(":input").serializeArray();$.each(g,function(k,l){a.append(l.name,l.value)});var d=fileInfoElTmp.clone();console.log(d);d.find(".media-uploader-status-text").html(messages.statuses.uploading);d.find(".upload-filename").html(b.name);var i=d.find(".media-uploader-status-image").children("img");i.attr("src",dropzoneRoutes.images+"/template/file-o.svg");var c=new Image();c.onload=function(k){i.attr("src",c.src)};c.src=URL.createObjectURL(b);$(".files-uploading-status").append(d);b.uploadResultElement=d},uploadprogress:function(c,a,b){c.uploadResultElement.find(".media-progress-value").width(a+"%")},error:function(d,b,f){$(d.previewElement).find(".dz-error-message").remove();if(f.status==422){var a=d.uploadResultElement.find(".media-uploader-status-info");var e=$('<div class="upload-errors"></div>');var c=$("<ul></ul>");if(b.file){$.each(b.file,function(h,g){c.append($("<li></li>").html(pd(g)))})}e.append(c);a.append(e);a.addClass("error");a.find(".media-uploader-status-text").html(messages.statuses.failed)}},success:function(c,b){var a=c.uploadResultElement;a.find(".media-uploader-status-text").html(messages.statuses.success)}}};function updateTarget(a,c){if(a.getUploadingFiles().length===0&&a.getQueuedFiles().length===0){var e=a.getAcceptedFiles();var b=[];var d=$("#"+c);$.each(e,function(f,g){if(g.status=="success"){var h=$.parseJSON(g.xhr.response);b.push(h.file)}});if(b.length){d.val(JSON.stringify(b))}else{d.val("")}}}function removeFromServer(d,b){if(d.xhr){var a=$.parseJSON(d.xhr.response);var e=a;e._token=csrfToken;var c=b.find(":input").serializeArray();$.each(c,function(f,g){e[g.name]=g.value});$.ajax({url:dropzoneRoutes.remove,type:"POST",data:e})}}$(document).ready(function(){$(document).on({click:function(){let row=$(this).closest(".media-uploader-status");if(row.length){row.remove()}}},".delete-upload-info")});