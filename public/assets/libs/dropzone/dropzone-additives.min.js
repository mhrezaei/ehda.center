Dropzone.autoDiscover=false;Dropzone.prototype.defaultOptions.url=dropzoneRoutes.upload;Dropzone.prototype.defaultOptions.addRemoveLinks=true;Dropzone.prototype.defaultOptions.dictRemoveFile="";Dropzone.prototype.defaultOptions.dictCancelUpload="";Dropzone.prototype.defaultOptions.dictFileTooBig=messages.errors.size;Dropzone.prototype.defaultOptions.dictInvalidFileType=messages.errors.type;Dropzone.prototype.defaultOptions.dictResponseError=messages.errors.server;Dropzone.prototype.defaultOptions.dictMaxFilesExceeded=messages.errors.size;let fileInfoElTmp=$('<div class="media-uploader-status"> <div class="col-xs-9"> <div class="media-uploader-status-info"> <h2 class="media-uploader-status-text"> </h2> <button type="button" class="fa fa-times-circle delete-upload-info"></button> <div class="media-progress"> <div class="media-progress-value"></div> </div> <div class="upload-detail"> <span class="upload-detail-separator"></span> <span class="upload-filename"></span> </div> </div> </div> <div class="col-xs-3"> <div class="attachment media-uploader-status-image"> <img> </div> </div></div>');let maxQueueLength=40;var dropzoneOptions={init:{sending:function(c,h,g){var f=this;g.append("_token",csrfToken);$(c.previewElement).hide();$(c.previewElement).closest(".uploader-container").find(".dz-message").show();var a=$(this.element).find(":input").serializeArray();$.each(a,function(i,j){g.append(j.name,j.value)});let currentExternalFields=$(f.element).find("#externalFields");let externalFields=currentExternalFields.length?$.parseJSON(currentExternalFields.val()):{};g.append("externalFields",JSON.stringify(externalFields));var b=fileInfoElTmp.clone();b.find(".media-uploader-status-text").html(messages.statuses.uploading);b.find(".upload-filename").html(c.name);b.find(".delete-upload-info").click(function(){f.removeFile(c)});var d=b.find(".media-uploader-status-image").children("img");d.attr("src",dropzoneRoutes.images+"/template/file-o.svg");var e=new Image();e.onload=function(i){d.attr("src",e.src)};e.src=URL.createObjectURL(c);$(".files-uploading-status").append(b);c.uploadResultElement=b},uploadprogress:function(c,a,b){if(a<100){c.uploadResultElement.find(".media-progress-value").width(a+"%")}},complete:function(a){a.uploadResultElement.find(".media-progress-value").width("100%")},error:function(b,a,c){console.log("----------------------------------------------------------");console.log(b);console.log(a);console.log(c.status);console.log("----------------------------------------------------------");$(b.previewElement).find(".dz-error-message").remove();console.log("-------------------------------------line------------------------------------");let uploadResultElement=b.uploadResultElement.find(".media-uploader-status-info");if(c.status==422){let errorsContainer=$('<div class="upload-errors"></div>');let ul=$("<ul></ul>");console.log(a.file);if(a.file){$.each(a.file,function(e,d){ul.append($("<li></li>").html(pd(d)))})}errorsContainer.append(ul);uploadResultElement.append(errorsContainer)}uploadResultElement.addClass("error");uploadResultElement.find(".media-uploader-status-text").html(messages.statuses.failed)},success:function(c,b){var a=c.uploadResultElement;a.find(".media-uploader-status-text").html(messages.statuses.success)}}};function updateTarget(a,c){if(a.getUploadingFiles().length===0&&a.getQueuedFiles().length===0){var e=a.getAcceptedFiles();var b=[];var d=$("#"+c);$.each(e,function(f,g){if(g.status=="success"){var h=$.parseJSON(g.xhr.response);b.push(h.file)}});if(b.length){d.val(JSON.stringify(b))}else{d.val("")}}}function removeFile(c,b){var a=c.uploadResultElement;if(a&&a.length){a.remove()}}function removeFromServer(d,b){if(d.xhr){var a=$.parseJSON(d.xhr.response);var e=a;e._token=csrfToken;var c=b.find(":input").serializeArray();$.each(c,function(f,g){e[g.name]=g.value});$.ajax({url:dropzoneRoutes.remove,type:"POST",data:e})}}function refreshDropzone(a){a.removeAllFiles()}$(document).ready(function(){$(document).on({click:function(){let row=$(this).closest(".media-uploader-status");if(row.length){row.remove()}}},".delete-upload-info")});