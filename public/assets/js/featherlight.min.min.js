!function(l){function o(d,c){if(!(this instanceof o)){var b=new o(d,c);return b.open(),b}this.id=o.id++,this.setup(d,c),this.chainCallbacks(o._callbackChain)}if("undefined"==typeof l){return void ("console" in window&&window.console.info("Too much lightness, Featherlight needs jQuery."))}var e=[],m=function(b){return e=l.grep(e,function(c){return c!==b&&c.$instance.closest("body").length>0})},i=function(g,j){var d={},h=new RegExp("^"+j+"([A-Z])(.*)");for(var f in g){var b=f.match(h);if(b){var c=(b[1]+b[2].replace(/([A-Z])/g,"-$1")).toLowerCase();d[c]=g[f]}}return d},p={keyup:"onKeyUp",resize:"onResize"},a=function(b){l.each(o.opened().reverse(),function(){return b.isDefaultPrevented()||!1!==this[p[b.type]](b)?void 0:(b.preventDefault(),b.stopPropagation(),!1)})},n=function(c){if(c!==o._globalHandlerInstalled){o._globalHandlerInstalled=c;var b=l.map(p,function(f,d){return d+"."+o.prototype.namespace}).join(" ");l(window)[c?"on":"off"](b,a)}};o.prototype={constructor:o,namespace:"featherlight",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",loading:"",persist:!1,otherClose:null,beforeOpen:l.noop,beforeContent:l.noop,beforeClose:l.noop,afterOpen:l.noop,afterContent:l.noop,afterClose:l.noop,onKeyUp:l.noop,onResize:l.noop,type:null,contentFilters:["jquery","image","html","ajax","iframe","text"],setup:function(b,d){"object"!=typeof b||b instanceof l!=0||d||(d=b,b=void 0);var h=l.extend(this,d,{target:b}),f=h.resetCss?h.namespace+"-reset":h.namespace,c=l(h.background||['<div class="'+f+"-loading "+f+'">','<div class="'+f+'-content">','<span class="'+f+"-close-icon "+h.namespace+'-close">',h.closeIcon,"</span>",'<div class="'+h.namespace+'-inner">'+h.loading+"</div>","</div>","</div>"].join("")),g="."+h.namespace+"-close"+(h.otherClose?","+h.otherClose:"");return h.$instance=c.clone().addClass(h.variant),h.$instance.on(h.closeTrigger+"."+h.namespace,function(j){var k=l(j.target);("background"===h.closeOnClick&&k.is("."+h.namespace)||"anywhere"===h.closeOnClick||k.closest(g).length)&&(h.close(j),j.preventDefault())}),this},getContent:function(){if(this.persist!==!1&&this.$content){return this.$content}var b=this,d=this.constructor.contentFilters,h=function(q){return b.$currentTarget&&b.$currentTarget.attr(q)},g=h(b.targetAttr),c=b.target||g||"",k=d[b.type];if(!k&&c in d&&(k=d[c],c=b.target&&g),c=c||h("href")||"",!k){for(var j in d){b[j]&&(k=d[j],c=b[j])}}if(!k){var f=c;if(c=null,l.each(b.contentFilters,function(){return k=d[this],k.test&&(c=k.test(f)),!c&&k.regex&&f.match&&f.match(k.regex)&&(c=f),!c}),!c){return"console" in window&&window.console.error("Featherlight: no content filter found "+(f?' for "'+f+'"':" (no target specified)")),!1}}return k.process.call(b,c)},setContent:function(b){var c=this;return(b.is("iframe")||l("iframe",b).length>0)&&c.$instance.addClass(c.namespace+"-iframe"),c.$instance.removeClass(c.namespace+"-loading"),c.$instance.find("."+c.namespace+"-inner").not(b).slice(1).remove().end().replaceWith(l.contains(c.$instance[0],b[0])?"":b),c.$content=b.addClass(c.namespace+"-inner"),c},open:function(b){var d=this;if(d.$instance.hide().appendTo(d.root),!(b&&b.isDefaultPrevented()||d.beforeOpen(b)===!1)){b&&b.preventDefault();var c=d.getContent();if(c){return e.push(d),n(!0),d.$instance.fadeIn(d.openSpeed),d.beforeContent(b),l.when(c).always(function(f){d.setContent(f),d.afterContent(b)}).then(d.$instance.promise()).done(function(){d.afterOpen(b)})}}return d.$instance.detach(),l.Deferred().reject().promise()},close:function(b){var c=this,d=l.Deferred();return c.beforeClose(b)===!1?d.reject():(0===m(c).length&&n(!1),c.$instance.fadeOut(c.closeSpeed,function(){c.$instance.detach(),c.afterClose(b),d.resolve()})),d.promise()},resize:function(d,c){if(d&&c){this.$content.css("width","").css("height","");var b=Math.max(d/(parseInt(this.$content.parent().css("width"),10)-1),c/(parseInt(this.$content.parent().css("height"),10)-1));b>1&&(b=c/Math.floor(c/b),this.$content.css("width",""+d/b+"px").css("height",""+c/b+"px"))}},chainCallbacks:function(b){for(var c in b){this[c]=l.proxy(b[c],this,l.proxy(this[c],this))}}},l.extend(o,{id:0,autoBind:"[data-featherlight]",defaults:o.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(b){return b instanceof l&&b},process:function(b){return this.persist!==!1?l(b):l(b).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff|bmp|svg)(\?\S*)?$/i,process:function(g){var f=this,d=l.Deferred(),b=new Image,c=l('<img src="'+g+'" alt="" class="'+f.namespace+'-image" />');return b.onload=function(){c.naturalWidth=b.width,c.naturalHeight=b.height,d.resolve(c)},b.onerror=function(){d.reject(c)},b.src=g,d.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(b){return l(b)}},ajax:{regex:/./,process:function(b){var c=l.Deferred(),d=l("<div></div>").load(b,function(f,g){"error"!==g&&c.resolve(d.contents()),c.fail()});return c.promise()}},iframe:{process:function(b){var c=new l.Deferred,d=l("<iframe/>").hide().attr("src",b).css(i(this,"iframe")).on("load",function(){c.resolve(d.show())}).appendTo(this.$instance.find("."+this.namespace+"-content"));return c.promise()}},text:{process:function(b){return l("<div>",{text:b})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(g,f){var d=this,b=new RegExp("^data-"+f+"-(.*)"),c={};return g&&g.attributes&&l.each(g.attributes,function(){var s=this.name.match(b);if(s){var j=this.value,h=k.camelCase(s[1]);if(k.inArray(h,d.functionAttributes)>=0){j=new Function(j)}else{try{j=k.parseJSON(j)}catch(k){}}c[h]=j}}),c},extend:function(b,c){var d=function(){this.constructor=b};return d.prototype=this.prototype,b.prototype=new d,b.__super__=this.prototype,l.extend(b,this,c),b.defaults=b.prototype,b},attach:function(b,d,g){var f=this;"object"!=typeof d||d instanceof l!=0||g||(g=d,d=void 0),g=l.extend({},g);var c,j=g.namespace||f.defaults.namespace,h=l.extend({},f.defaults,f.readElementConfig(b[0],j),g);return b.on(h.openTrigger+"."+h.namespace,h.filter,function(k){var q=l.extend({$source:b,$currentTarget:l(this)},f.readElementConfig(b[0],h.namespace),f.readElementConfig(this,h.namespace),g),r=c||l(this).data("featherlight-persisted")||new f(d,q);"shared"===r.persist?c=r:r.persist!==!1&&l(this).data("featherlight-persisted",r),q.$currentTarget.blur(),r.open(k)}),b},current:function(){var b=this.opened();return b[b.length-1]||null},opened:function(){var b=this;return m(),l.grep(e,function(c){return c instanceof b})},close:function(c){var b=this.current();return b?b.close(c):void 0},_onReady:function(){var b=this;b.autoBind&&(l(b.autoBind).each(function(){b.attach(l(this))}),l(document).on("click",b.autoBind,function(c){c.isDefaultPrevented()||"featherlight"===c.namespace||(c.preventDefault(),b.attach(l(c.currentTarget)),l(c.target).trigger("click.featherlight"))}))},_callbackChain:{onKeyUp:function(b,c){return 27===c.keyCode?(this.closeOnEsc&&l.featherlight.close(c),!1):b(c)},onResize:function(c,b){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),c(b)},afterContent:function(d,c){var b=d(c);return this.onResize(c),b}}}),l.featherlight=o,l.fn.featherlight=function(b,c){return o.attach(this,b,c)},l(document).ready(function(){o._onReady()})}(jQuery);