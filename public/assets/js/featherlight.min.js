!function(h){function d(i,l){if(!(this instanceof d)){var a=new d(i,l);return a.open(),a}this.id=d.id++,this.setup(i,l),this.chainCallbacks(d._callbackChain)}if("undefined"==typeof h){return void ("console" in window&&window.console.info("Too much lightness, Featherlight needs jQuery."))}var k=[],g=function(a){return k=h.grep(k,function(i){return i!==a&&i.$instance.closest("body").length>0})},j=function(s,p){var v={},q=new RegExp("^"+p+"([A-Z])(.*)");for(var u in s){var m=u.match(q);if(m){var l=(m[1]+m[2].replace(/([A-Z])/g,"-$1")).toLowerCase();v[l]=s[u]}}return v},c={keyup:"onKeyUp",resize:"onResize"},b=function(a){h.each(d.opened().reverse(),function(){return a.isDefaultPrevented()||!1!==this[c[a.type]](a)?void 0:(a.preventDefault(),a.stopPropagation(),!1)})},f=function(e){if(e!==d._globalHandlerInstalled){d._globalHandlerInstalled=e;var a=h.map(c,function(i,l){return l+"."+d.prototype.namespace}).join(" ");h(window)[e?"on":"off"](a,b)}};d.prototype={constructor:d,namespace:"featherlight",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",loading:"",persist:!1,otherClose:null,beforeOpen:h.noop,beforeContent:h.noop,beforeClose:h.noop,afterOpen:h.noop,afterContent:h.noop,afterClose:h.noop,onKeyUp:h.noop,onResize:h.noop,type:null,contentFilters:["jquery","image","html","ajax","iframe","text"],setup:function(m,s){"object"!=typeof m||m instanceof h!=0||s||(s=m,m=void 0);var p=h.extend(this,s,{target:m}),q=p.resetCss?p.namespace+"-reset":p.namespace,l=h(p.background||['<div class="'+q+"-loading "+q+'">','<div class="'+q+'-content">','<span class="'+q+"-close-icon "+p.namespace+'-close">',p.closeIcon,"</span>",'<div class="'+p.namespace+'-inner">'+p.loading+"</div>","</div>","</div>"].join("")),e="."+p.namespace+"-close"+(p.otherClose?","+p.otherClose:"");return p.$instance=l.clone().addClass(p.variant),p.$instance.on(p.closeTrigger+"."+p.namespace,function(a){var i=h(a.target);("background"===p.closeOnClick&&i.is("."+p.namespace)||"anywhere"===p.closeOnClick||i.closest(e).length)&&(p.close(a),a.preventDefault())}),this},getContent:function(){if(this.persist!==!1&&this.$content){return this.$content}var m=this,w=this.constructor.contentFilters,q=function(a){return m.$currentTarget&&m.$currentTarget.attr(a)},u=q(m.targetAttr),l=m.target||u||"",e=w[m.type];if(!e&&l in w&&(e=w[l],l=m.target&&u),l=l||q("href")||"",!e){for(var p in w){m[p]&&(e=w[p],l=m[p])}}if(!e){var v=l;if(l=null,h.each(m.contentFilters,function(){return e=w[this],e.test&&(l=e.test(v)),!l&&e.regex&&v.match&&v.match(e.regex)&&(l=v),!l}),!l){return"console" in window&&window.console.error("Featherlight: no content filter found "+(v?' for "'+v+'"':" (no target specified)")),!1}}return e.process.call(m,l)},setContent:function(a){var e=this;return(a.is("iframe")||h("iframe",a).length>0)&&e.$instance.addClass(e.namespace+"-iframe"),e.$instance.removeClass(e.namespace+"-loading"),e.$instance.find("."+e.namespace+"-inner").not(a).slice(1).remove().end().replaceWith(h.contains(e.$instance[0],a[0])?"":a),e.$content=a.addClass(e.namespace+"-inner"),e},open:function(a){var e=this;if(e.$instance.hide().appendTo(e.root),!(a&&a.isDefaultPrevented()||e.beforeOpen(a)===!1)){a&&a.preventDefault();var i=e.getContent();if(i){return k.push(e),f(!0),e.$instance.fadeIn(e.openSpeed),e.beforeContent(a),h.when(i).always(function(l){e.setContent(l),e.afterContent(a)}).then(e.$instance.promise()).done(function(){e.afterOpen(a)})}}return e.$instance.detach(),h.Deferred().reject().promise()},close:function(a){var i=this,e=h.Deferred();return i.beforeClose(a)===!1?e.reject():(0===g(i).length&&f(!1),i.$instance.fadeOut(i.closeSpeed,function(){i.$instance.detach(),i.afterClose(a),e.resolve()})),e.promise()},resize:function(i,a){if(i&&a){this.$content.css("width","").css("height","");var l=Math.max(i/(parseInt(this.$content.parent().css("width"),10)-1),a/(parseInt(this.$content.parent().css("height"),10)-1));l>1&&(l=a/Math.floor(a/l),this.$content.css("width",""+i/l+"px").css("height",""+a/l+"px"))}},chainCallbacks:function(a){for(var e in a){this[e]=h.proxy(a[e],this,h.proxy(this[e],this))}}},h.extend(d,{id:0,autoBind:"[data-featherlight]",defaults:d.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(a){return a instanceof h&&a},process:function(a){return this.persist!==!1?h(a):h(a).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff|bmp|svg)(\?\S*)?$/i,process:function(e){var p=this,l=h.Deferred(),m=new Image,a=h('<img src="'+e+'" alt="" class="'+p.namespace+'-image" />');return m.onload=function(){a.naturalWidth=m.width,a.naturalHeight=m.height,l.resolve(a)},m.onerror=function(){l.reject(a)},m.src=e,l.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(a){return h(a)}},ajax:{regex:/./,process:function(a){var i=h.Deferred(),e=h("<div></div>").load(a,function(m,l){"error"!==l&&i.resolve(e.contents()),i.fail()});return i.promise()}},iframe:{process:function(a){var i=new h.Deferred,e=h("<iframe/>").hide().attr("src",a).css(j(this,"iframe")).on("load",function(){i.resolve(e.show())}).appendTo(this.$instance.find("."+this.namespace+"-content"));return i.promise()}},text:{process:function(a){return h("<div>",{text:a})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(e,p){var l=this,m=new RegExp("^data-"+p+"-(.*)"),a={};return e&&e.attributes&&h.each(e.attributes,function(){var o=this.name.match(m);if(o){var r=this.value,i=q.camelCase(o[1]);if(q.inArray(i,l.functionAttributes)>=0){r=new Function(r)}else{try{r=q.parseJSON(r)}catch(q){}}a[i]=r}}),a},extend:function(a,i){var e=function(){this.constructor=a};return e.prototype=this.prototype,a.prototype=new e,a.__super__=this.prototype,h.extend(a,this,i),a.defaults=a.prototype,a},attach:function(m,v,q){var u=this;"object"!=typeof v||v instanceof h!=0||q||(q=v,v=void 0),q=h.extend({},q);var l,e=q.namespace||u.defaults.namespace,p=h.extend({},u.defaults,u.readElementConfig(m[0],e),q);return m.on(p.openTrigger+"."+p.namespace,p.filter,function(i){var o=h.extend({$source:m,$currentTarget:h(this)},u.readElementConfig(m[0],p.namespace),u.readElementConfig(this,p.namespace),q),n=l||h(this).data("featherlight-persisted")||new u(v,o);"shared"===n.persist?l=n:n.persist!==!1&&h(this).data("featherlight-persisted",n),o.$currentTarget.blur(),n.open(i)}),m},current:function(){var a=this.opened();return a[a.length-1]||null},opened:function(){var a=this;return g(),h.grep(k,function(i){return i instanceof a})},close:function(i){var a=this.current();return a?a.close(i):void 0},_onReady:function(){var a=this;a.autoBind&&(h(a.autoBind).each(function(){a.attach(h(this))}),h(document).on("click",a.autoBind,function(e){e.isDefaultPrevented()||"featherlight"===e.namespace||(e.preventDefault(),a.attach(h(e.currentTarget)),h(e.target).trigger("click.featherlight"))}))},_callbackChain:{onKeyUp:function(a,e){return 27===e.keyCode?(this.closeOnEsc&&h.featherlight.close(e),!1):a(e)},onResize:function(i,a){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),i(a)},afterContent:function(i,a){var l=i(a);return this.onResize(a),l}}}),h.featherlight=d,h.fn.featherlight=function(a,i){return d.attach(this,a,i)},h(document).ready(function(){d._onReady()})}(jQuery);