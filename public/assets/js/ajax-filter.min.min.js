var ajaxDelay=1;var ajaxTimer=new Timer();var runningXhr=null;var filterableAttributes=[];var filterData={};var filterUrl="";$(document).ready(function(){initialFilter();$(window).on("hashchange",function(b){b.preventDefault();initialFilter(true)});$(".ajax-sort").change(function(){var b=$(this).find("option:selected");if(typeof filterData.sort=="undefined"){filterData.sort={}}filterData.sort[b.attr("data-identifier")]=b.val();modifyUrl()})});function initialFilter(g){var f=$(".filters-panel");filterData={};if(!isDefined(g)||!g){g=false}if(f.length){var e=f.attr("data-filter-url");if(typeof e!==typeof undefined){var h=decryptHash(getHashUrl());if(isDefined(h.pagination)){filterData.pagination=h.pagination}if(isDefined(h.sort)){filterData.sort=h.sort}filterUrl=e;f.find(".filter-text").each(function(b){var a=$(this);var c=a.attr("data-identifier");filterableAttributes.push(c);if(!g){a.on({keyup:function(d){filterWithText($(this).val(),c);if(d.originalEvent){resetPageNumber();modifyUrl()}}},"input[type=text]")}if(isDefined(h.text)&&isDefined(h.text[c])&&h.text[c]){a.find("input[type=text]").val(h.text[c]).keyup()}else{a.find("input[type=text]").val("").keyup()}});f.find(".filter-slider").each(function(o){var q=$(this);var d=q.attr("data-identifier");var t=q.find(".slider-container");var c=t.find(".min-label");var p=t.find(".max-label");var r=parseInt(t.attr("data-min"));var b=parseInt(t.attr("data-max"));filterableAttributes.push(d);if(isDefined(h.range)&&isDefined(h.range[d])&&isDefined(h.range[d]["min"])&&isDefined(h.range[d]["max"])){var a=[h.range[d]["min"],h.range[d]["max"]]}else{var a=[r,b]}var s=t.find(".slider-self");if(g){s.slider("values",a)}else{s.slider({range:true,min:r,max:b,values:[r,b],change:function(j,i){c.html(ad(nummber_format(i.values[0])));p.html(ad(nummber_format(i.values[1])));filterWithRange(i.values[0],i.values[1],d,[s.slider("option","min"),s.slider("option","max")]);if(j.originalEvent){resetPageNumber();modifyUrl()}}});s.slider("values",a)}c.html(ad(nummber_format(a[0])));p.html(ad(nummber_format(a[1])))});f.find(".filter-checkbox").each(function(b){var a=$(this);var c=a.attr("data-identifier");filterableAttributes.push(c);if(!g){a.on({change:function(j){filterWithCheckBox(c);if(j.originalEvent){resetPageNumber();modifyUrl()}}},"input[type=checkbox]")}var d=a.find("input[type=checkbox]");if(isDefined(h.checkbox)&&isDefined(h.checkbox[c])){d.each(function(){var j=$(this).val();if(!$.isArray(h.checkbox[c])){h.checkbox[c]=[h.checkbox[c]]}if($.inArray(j,h.checkbox[c])>-1){$(this).prop("checked",true)}else{$(this).prop("checked",false)}})}else{d.prop("checked",true)}d.last().change()});f.find(".filter-switch-checkbox").each(function(b){var a=$(this);var c=a.attr("data-identifier");filterableAttributes.push(c);if(!g){a.on({change:function(d){filterWithSwitchCheckBox($(this).is(":checked"),c);if(d.originalEvent){resetPageNumber();modifyUrl()}}},"input[type=checkbox]")}if(isDefined(h.switchKey)&&isDefined(h.switchKey[c])&&h.switchKey[c]){a.find("input[type=checkbox]").prop("checked",true).change()}else{a.find("input[type=checkbox]").prop("checked",false).change()}});modifyUrl();if(g){doFilter()}else{doFilter(0)}}else{console.warn("Filter URL is not defined!")}}}function filterWithText(c,d){if(typeof filterData.text=="undefined"){filterData.text={}}if(c){filterData.text[d]=c}else{delete filterData.text[d]}}function filterWithRange(g,f,h,e){if(typeof filterData.range=="undefined"){filterData.range={}}if(!e||!$.isArray(e)||g>e[0]||f<e[1]){filterData.range[h]={min:g,max:f}}else{delete filterData.range[h]}}function filterWithCheckBox(f,h){if(typeof h=="undefined"){h=false}var g=$("input[type=checkbox][id^="+f+"]");var e=[];g.each(function(){if($(this).is(":checked")){e.push($(this).val())}});if(typeof filterData.checkbox=="undefined"){filterData.checkbox={}}if(e.length<g.length){filterData.checkbox[f]=e}else{delete filterData.checkbox[f]}}function filterWithSwitchCheckBox(c,d){if(typeof filterData.switchKey=="undefined"){filterData.switchKey={}}if(c){filterData.switchKey[d]=c}else{delete filterData.switchKey[d]}}function encryptHash(c){var d="";$.each(c,function(f,a){if(Object.keys(a).length){d+="!";var b=[];$.each(a,function(i,e){var j=i+"_";switch(typeof e){case"boolean":b.push(j+((e)?1:0));break;case"string":b.push(j+e);break;case"object":if($.isArray(e)){$.each(e,function(h,g){if(typeof g=="boolean"){b.push(j+((g)?1:0))}else{b.push(j+g)}})}else{$.each(e,function(l,g){var h=j+l+"_";if(typeof g=="boolean"){b.push(h+((g)?1:0))}else{b.push(h+g)}})}break}});d+=b.join("/");d+="?"+f}});d+=((d)?"!":"");return d}function decryptHash(c){var d={};c=c.splitNotEmpty("!");if(c){$.each(c,function(b,a){a=a.splitNotEmpty("?");if(a.length==2){d[a[1]]=a[0].splitNotEmpty("/");d[a[1]]=prefixToIndex("_",d[a[1]])}})}return d}function doFilter(d){var f=$(".result-container");f.addClass("loading");loadingDialog();if(isDefined(d)){var e=d}else{var e=ajaxDelay}ajaxTimer.delay(function(){var a=getHashUrl();runningXhr=$.ajax({type:"POST",url:filterUrl,data:{hash:a,_token:window.Laravel.csrfToken},beforeSend:function(){if(runningXhr){runningXhr.abort();console.warn("Filter request canceled!")}},success:function(b){f.replaceWith($(b));$("#category-header").scrollToView(-20);modifyPaginationLinks()},complete:function(){runningXhr=null;loadingDialog("hide")}})},e)}function modifyUrl(d){var c=encryptHash(ksort(filterData));if(c!=getHashUrl()){setHashUrl(c)}}function modifyPaginationLinks(){$(".pagination li:not(.active):not(.disabled) a").each(function(){var j=$(this),k=j.attr("href");var l=getUrlParameterByName("page",k);if(l!=null){k=removeUrlParameterByName("page",k);var i=getHashUrl(k);var h=decryptHash(i);h.pagination={};h.pagination.page=l;var g=encryptHash(h);j.attr("href",setHashUrl(g,k))}})}function resetPageNumber(){delete filterData.pagination}function resetFilters(){filterData={};modifyUrl()};