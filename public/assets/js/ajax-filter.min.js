var ajaxDelay=1;var ajaxTimer=new Timer();var runningXhr=null;var filterableAttributes=[];var filterData={};var filterUrl="";$(document).ready(function(){initialFilter();$(window).on("hashchange",function(a){a.preventDefault();initialFilter(true)});$(".ajax-sort").change(function(){var a=$(this).find("option:selected");if(typeof filterData.sort=="undefined"){filterData.sort={}}filterData.sort[a.attr("data-identifier")]=a.val();modifyUrl()})});function initialFilter(d){var a=$(".filters-panel");filterData={};if(!isDefined(d)||!d){d=false}if(a.length){var b=a.attr("data-filter-url");if(typeof b!==typeof undefined){var c=decryptHash(getHashUrl());if(isDefined(c.pagination)){filterData.pagination=c.pagination}if(isDefined(c.sort)){filterData.sort=c.sort}filterUrl=b;a.find(".filter-text").each(function(f){var g=$(this);var e=g.attr("data-identifier");filterableAttributes.push(e);if(!d){g.on({keyup:function(h){filterWithText($(this).val(),e);if(h.originalEvent){resetPageNumber();modifyUrl()}}},"input[type=text]")}if(isDefined(c.text)&&isDefined(c.text[e])&&c.text[e]){g.find("input[type=text]").val(c.text[e]).keyup()}else{g.find("input[type=text]").val("").keyup()}});a.find(".filter-slider").each(function(j){var h=$(this);var k=h.attr("data-identifier");var e=h.find(".slider-container");var l=e.find(".min-label");var i=e.find(".max-label");var g=parseInt(e.attr("data-min"));var m=parseInt(e.attr("data-max"));filterableAttributes.push(k);if(isDefined(c.range)&&isDefined(c.range[k])&&isDefined(c.range[k]["min"])&&isDefined(c.range[k]["max"])){var n=[c.range[k]["min"],c.range[k]["max"]]}else{var n=[g,m]}var f=e.find(".slider-self");if(d){f.slider("values",n)}else{f.slider({range:true,min:g,max:m,values:[g,m],change:function(o,p){l.html(ad(nummber_format(p.values[0])));i.html(ad(nummber_format(p.values[1])));filterWithRange(p.values[0],p.values[1],k,[f.slider("option","min"),f.slider("option","max")]);if(o.originalEvent){resetPageNumber();modifyUrl()}}});f.slider("values",n)}l.html(ad(nummber_format(n[0])));i.html(ad(nummber_format(n[1])))});a.find(".filter-checkbox").each(function(g){var h=$(this);var f=h.attr("data-identifier");filterableAttributes.push(f);if(!d){h.on({change:function(i){filterWithCheckBox(f);if(i.originalEvent){resetPageNumber();modifyUrl()}}},"input[type=checkbox]")}var e=h.find("input[type=checkbox]");if(isDefined(c.checkbox)&&isDefined(c.checkbox[f])){e.each(function(){var i=$(this).val();if(!$.isArray(c.checkbox[f])){c.checkbox[f]=[c.checkbox[f]]}if($.inArray(i,c.checkbox[f])>-1){$(this).prop("checked",true)}else{$(this).prop("checked",false)}})}else{e.prop("checked",true)}e.last().change()});a.find(".filter-switch-checkbox").each(function(f){var g=$(this);var e=g.attr("data-identifier");filterableAttributes.push(e);if(!d){g.on({change:function(h){filterWithSwitchCheckBox($(this).is(":checked"),e);if(h.originalEvent){resetPageNumber();modifyUrl()}}},"input[type=checkbox]")}if(isDefined(c.switchKey)&&isDefined(c.switchKey[e])&&c.switchKey[e]){g.find("input[type=checkbox]").prop("checked",true).change()}else{g.find("input[type=checkbox]").prop("checked",false).change()}});a.find(".filter-select").each(function(g){var h=$(this);var f=h.attr("data-identifier");filterableAttributes.push(f);if(!d){h.on({change:function(){if($(this).prop("multiple")){var i=$(this).val()}else{var i=[$(this).val()]}filterWithSelectBox(i,f);modifyUrl()}},"select")}var e=h.find("select");if(isDefined(c.selectBox)&&isDefined(c.selectBox[f])){e.each(function(){var i=$(this);if(!$.isArray(c.selectBox[f])){c.selectBox[f]=[c.selectBox[f]]}i.val(c.selectBox[f])})}else{e.each(function(){var j=$(this);var i=j.children("option").first();if(i.length){j.val(i.val())}})}e.change()});modifyUrl();if(d){doFilter()}else{doFilter(0)}}else{console.warn("Filter URL is not defined!")}}}function filterWithText(b,a){if(typeof filterData.text=="undefined"){filterData.text={}}if(b){filterData.text[a]=b}else{delete filterData.text[a]}}function filterWithRange(d,a,c,b){if(typeof filterData.range=="undefined"){filterData.range={}}if(!b||!$.isArray(b)||d>b[0]||a<b[1]){filterData.range[c]={min:d,max:a}}else{delete filterData.range[c]}}function filterWithCheckBox(a,c){if(typeof c=="undefined"){c=false}var d=$("input[type=checkbox][id^="+a+"]");var b=[];d.each(function(){if($(this).is(":checked")){b.push($(this).val())}});if(typeof filterData.checkbox=="undefined"){filterData.checkbox={}}if(b.length<d.length){filterData.checkbox[a]=b}else{delete filterData.checkbox[a]}}function filterWithSwitchCheckBox(b,a){if(typeof filterData.switchKey=="undefined"){filterData.switchKey={}}if(b){filterData.switchKey[a]=b}else{delete filterData.switchKey[a]}}function filterWithSelectBox(b,a){if(typeof filterData.selectBox=="undefined"){filterData.selectBox={}}if(b.length){filterData.selectBox[a]=b}else{delete filterData.selectBox[a]}}function encryptHash(b){var a="";$.each(b,function(c,e){if(Object.keys(e).length){a+="!";var d=[];$.each(e,function(g,h){var f=g+"_";switch(typeof h){case"boolean":d.push(f+((h)?1:0));break;case"string":d.push(f+h);break;case"object":if($.isArray(h)){$.each(h,function(j,k){if(typeof k=="boolean"){d.push(f+((k)?1:0))}else{d.push(f+k)}})}else{$.each(h,function(i,k){var j=f+i+"_";if(typeof k=="boolean"){d.push(j+((k)?1:0))}else{d.push(j+k)}})}break}});a+=d.join("/");a+="?"+c}});a+=((a)?"!":"");return a}function decryptHash(b){var a={};b=b.splitNotEmpty("!");if(b){$.each(b,function(c,d){d=d.splitNotEmpty("?");if(d.length==2){a[d[1]]=d[0].splitNotEmpty("/");a[d[1]]=prefixToIndex("_",a[d[1]])}})}return a}function doFilter(b){var c=$(".result-container");c.addClass("loading");loadingDialog();if(isDefined(b)){var a=b}else{var a=ajaxDelay}ajaxTimer.delay(function(){var d=getHashUrl();runningXhr=$.ajax({type:"POST",url:filterUrl,data:{hash:d,_token:window.Laravel.csrfToken},beforeSend:function(){if(runningXhr){runningXhr.abort();console.warn("Filter request canceled!")}},success:function(e){c.replaceWith($(e));$("#category-header").scrollToView(-20);modifyPaginationLinks()},complete:function(){runningXhr=null;loadingDialog("hide")}})},a)}function modifyUrl(a){var b=encryptHash(ksort(filterData));if(b!=getHashUrl()){setHashUrl(b)}}function modifyPaginationLinks(){$(".pagination li:not(.active):not(.disabled) a").each(function(){var e=$(this),d=e.attr("href");var c=getUrlParameterByName("page",d);if(c!=null){d=removeUrlParameterByName("page",d);var f=getHashUrl(d);var a=decryptHash(f);a.pagination={};a.pagination.page=c;var b=encryptHash(a);e.attr("href",setHashUrl(b,d))}})}function resetPageNumber(){delete filterData.pagination}function resetFilters(){filterData={};modifyUrl()};